import{o as p}from"./chunk-IPMXVKSW.js";import{Z as g,ba as m}from"./chunk-KP5MESBS.js";import{a as l,b as u,h as o}from"./chunk-FK42CRUA.js";var f=class d{constructor(t){this.db=t}crearTurno(t){return o(this,null,function*(){let{error:i}=yield this.db.cliente.from("turnos").insert([t]);if(i)throw new Error(i.message);return!0})}obtenerTurnosPorUsuario(t,i){return o(this,null,function*(){let e=null,a=null;if(i==="paciente"?{data:e,error:a}=yield this.db.cliente.from("turnos").select(`
      *,
      especialidad:especialidades ( * ),
      especialista:id_especialista ( * ),
      paciente:id_paciente ( * ),
      encuesta:id_encuesta (*),
      historia_clinica:id_historia_clinica (*)
    `).eq("id_paciente",t).order("dia",{ascending:!1}).order("hora",{ascending:!0}):i==="especialista"?{data:e,error:a}=yield this.db.cliente.from("turnos").select(`
      *,
      especialidad:especialidades ( * ),
      especialista:id_especialista ( * ),
      paciente:id_paciente ( * ),
      encuesta:id_encuesta (*),
      historia_clinica:id_historia_clinica (*)
    `).eq("id_especialista",t).order("dia",{ascending:!1}).order("hora",{ascending:!0}):{data:e,error:a}=yield this.db.cliente.from("turnos").select(`
        *,
        especialidad:especialidades ( * ),
        paciente:id_paciente ( * ),
        especialista:id_especialista ( * ),
        encuesta:id_encuesta (*),
        historia_clinica:id_historia_clinica (*)
      `).order("dia",{ascending:!1}).order("hora",{ascending:!0}),a)throw new Error(a.message);return e||[]})}actualizarEstadoTurno(t,i){return o(this,null,function*(){let{error:e}=yield this.db.cliente.from("turnos").update({estado:i}).eq("id",t);if(e)throw new Error(e.message);return!0})}actualizarTurnoCancelado(t,i,e){return o(this,null,function*(){let{error:a}=yield this.db.cliente.from("turnos").update({estado:i,motivo_cancelacion:e}).eq("id",t);if(a)throw new Error(a.message);return!0})}actualizarTurnoRechazado(t,i,e){return o(this,null,function*(){let{error:a}=yield this.db.cliente.from("turnos").update({estado:i,motivo_rechazo:e}).eq("id",t);if(a)throw new Error(a.message);return!0})}actualizarCalificarAtencion(t,i){return o(this,null,function*(){let{error:e}=yield this.db.cliente.from("turnos").update({calificar_atencion:i}).eq("id",t);if(e)throw new Error(e.message);return!0})}actualizarEncuesta(t,i){return o(this,null,function*(){let{error:e}=yield this.db.cliente.from("turnos").update({id_encuesta:i}).eq("id",t);if(e)throw new Error(e.message);return!0})}actualizarHistoriaClinica(t,i){return o(this,null,function*(){let{error:e}=yield this.db.cliente.from("turnos").update({id_historia_clinica:i}).eq("id",t);if(e)throw new Error(e.message);return!0})}actualizarTurnoFinalizado(t,i,e){return o(this,null,function*(){let{error:a}=yield this.db.cliente.from("turnos").update({estado:i,resena:e}).eq("id",t);if(a)throw new Error(a.message);return!0})}obtenerTurnosProx15Dias(t,i){return o(this,null,function*(){let e=new Date,a=new Date(e),n=new Date(e);n.setDate(e.getDate()+15);let r="id_especialista";i==="paciente"&&(r="id_paciente");let{data:s,error:c}=yield this.db.cliente.from("turnos").select("dia, hora").eq(r,t).gte("dia",a.toISOString().slice(0,10)).lte("dia",n.toISOString().slice(0,10));if(c)throw new Error(c.message);return s??[]})}obtenerPacientesDeEspecialista(t){return o(this,null,function*(){let{data:i,error:e}=yield this.db.cliente.from("turnos").select("paciente:id_paciente ( * )").eq("id_especialista",t).eq("estado","finalizado").order("dia",{ascending:!1}).order("hora",{ascending:!0});if(e)throw new Error(e.message);let a=[],n=new Set;for(let r of i??[]){let s=r.paciente;if(s&&!n.has(s.id)){n.add(s.id);let c=u(l({},s),{imagen_1_path:s.imagen_1_path?this.db.cliente.storage.from("images").getPublicUrl(s.imagen_1_path).data.publicUrl:null,imagen_2_path:s.imagen_2_path?this.db.cliente.storage.from("images").getPublicUrl(s.imagen_2_path).data.publicUrl:null});a.push(c)}}return a})}obtenerTurnosFinalizadosPaciente(t){return o(this,null,function*(){let{data:i,error:e}=yield this.db.cliente.from("turnos").select(`
      *,
      especialidad:especialidades ( * ),
        paciente:id_paciente ( * ),
        especialista:id_especialista ( * ),
        historia_clinica:id_historia_clinica (*)
    `).eq("id_paciente",t).eq("estado","finalizado").not("id_historia_clinica","is",null).order("dia",{ascending:!0}).order("hora",{ascending:!0});if(e)throw new Error(e.message);return i??[]})}obtenerCantidadTurnosPorEspecialidad(){return o(this,null,function*(){let{data:t,error:i}=yield this.db.cliente.from("turnos").select("especialidad:especialidades ( * )").eq("estado","finalizado");if(i)throw new Error(i.message);let e=t,a=new Map;for(let n of e??[]){let r=n.especialidad.nombre;a.set(r,(a.get(r)??0)+1)}return Array.from(a,([n,r])=>({nombre:n,cantidad:r}))})}obtenerCantidadTurnosPorDia(){return o(this,null,function*(){let{data:t,error:i}=yield this.db.cliente.from("turnos").select("dia").eq("estado","finalizado").order("dia",{ascending:!0});if(i)throw new Error(i.message);let e=t,a=new Map;for(let n of e??[]){let r=n.dia;a.set(r,(a.get(r)??0)+1)}return Array.from(a,([n,r])=>{let s=new Date(n);return{dia:`${s.getDate().toString().padStart(2,"0")}/${(s.getMonth()+1).toString().padStart(2,"0")}/${s.getFullYear()}`,cantidad:r}})})}obtenerCantidadTurnosPorEspecialista(){return o(this,null,function*(){let{data:t,error:i}=yield this.db.cliente.from("turnos").select("especialista:id_especialista ( * ), dia");if(i)throw new Error(i.message);let e=t,a=new Map;for(let n of e??[]){let r=n.especialista.nombre+" "+n.especialista.apellido;a.set(r,(a.get(r)??0)+1)}return Array.from(a,([n,r])=>({nombre:n,cantidad:r}))})}obtenerCantidadTurnosPorEspecialistaEntreFechas(t,i){return o(this,null,function*(){let{data:e,error:a}=yield this.db.cliente.from("turnos").select("especialista:id_especialista ( * ), dia").gte("created_at",t).lte("created_at",i);if(a)throw new Error(a.message);let n=e,r=new Map;for(let s of n??[]){let c=s.especialista.nombre+" "+s.especialista.apellido;r.set(c,(r.get(c)??0)+1)}return Array.from(r,([s,c])=>({nombre:s,cantidad:c}))})}obtenerCantidadTurnosFinalizadosPorEspecialista(){return o(this,null,function*(){let{data:t,error:i}=yield this.db.cliente.from("turnos").select("especialista:id_especialista ( * ), dia").eq("estado","finalizado");if(i)throw new Error(i.message);let e=t,a=new Map;for(let n of e??[]){let r=n.especialista.nombre+" "+n.especialista.apellido;a.set(r,(a.get(r)??0)+1)}return Array.from(a,([n,r])=>({nombre:n,cantidad:r}))})}obtenerCantidadTurnosFinalizadosPorEspecialistaEntreFechas(t,i){return o(this,null,function*(){let{data:e,error:a}=yield this.db.cliente.from("turnos").select("especialista:id_especialista ( * ), dia").gte("dia",t).lte("dia",i).eq("estado","finalizado");if(a)throw new Error(a.message);let n=e,r=new Map;for(let s of n??[]){let c=s.especialista.nombre+" "+s.especialista.apellido;r.set(c,(r.get(c)??0)+1)}return Array.from(r,([s,c])=>({nombre:s,cantidad:c}))})}static \u0275fac=function(i){return new(i||d)(m(p))};static \u0275prov=g({token:d,factory:d.\u0275fac,providedIn:"root"})};export{f as a};
