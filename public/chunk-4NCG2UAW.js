import{a as Y}from"./chunk-6XKU33HG.js";import{i as N,p as j,q as A,s as z,t as H}from"./chunk-IPMXVKSW.js";import"./chunk-LJ5XHLMQ.js";import{Ab as g,Fb as n,Gb as a,Hb as P,Lb as S,Mb as O,Qb as h,Ra as M,Rb as c,Sa as r,ab as v,bc as w,dc as l,fc as k,gb as $,gc as D,ha as x,ia as b,kc as I,rc as V,tc as U,vb as C,wb as T,yb as L,zb as f}from"./chunk-KP5MESBS.js";import{h as _}from"./chunk-FK42CRUA.js";var F=(t,i)=>i.id,B=(t,i)=>i.dia_semana,G=(t,i)=>i.fecha;function J(t,i){if(t&1){let e=S();n(0,"div",11),h("click",function(){let s=x(e).$implicit,d=c(2);return b(d.seleccionarPaciente(s))}),n(1,"div",12),P(2,"img",13),a(),n(3,"span",14),l(4),a()()}if(t&2){let e=i.$implicit,o=c(2);w("seleccionada",(o.pacienteSeleccionado==null?null:o.pacienteSeleccionado.id)===e.id),r(2),O("alt",I(e.nombre))("src",e.imagen_1_path,M),r(2),D("",e.nombre," ",e.apellido)}}function Q(t,i){if(t&1&&(n(0,"div",2)(1,"h6",4),l(2,"Eleg\xED un paciente"),a(),n(3,"div",9),f(4,J,5,7,"div",10,F),a()()),t&2){let e=c();r(4),g(e.pacientes)}}function R(t,i){if(t&1){let e=S();n(0,"button",15),h("click",function(){let s=x(e).$implicit,d=c();return b(d.seleccionarEspecialidad(s))}),P(1,"div",16),n(2,"span",17),l(3),a()()}if(t&2){let e=i.$implicit,o=c();w("seleccionada",(o.especialidadSeleccionada==null?null:o.especialidadSeleccionada.id)===e.id),r(3),k(" ",e.nombre," ")}}function K(t,i){if(t&1){let e=S();n(0,"div",11),h("click",function(){let s=x(e).$implicit,d=c(2);return b(d.seleccionarProfesional(s))}),n(1,"div",12),P(2,"img",13),a(),n(3,"span",14),l(4),a()()}if(t&2){let e=i.$implicit,o=c(2);w("seleccionada",(o.profesionalSeleccionado==null?null:o.profesionalSeleccionado.id)===e.id),r(2),O("alt",I(e.nombre))("src",e.imagen_1_path,M),r(2),D("",e.nombre," ",e.apellido)}}function W(t,i){if(t&1&&(n(0,"div",2)(1,"h6",4),l(2,"Eleg\xED un profesional"),a(),n(3,"div",9),f(4,K,5,7,"div",10,F),a()()),t&2){let e=c();r(4),g(e.profesionales)}}function X(t,i){if(t&1){let e=S();n(0,"button",20),h("click",function(){let s=x(e).$implicit,d=c(2);return b(d.seleccionarDia(s))}),l(1),a()}if(t&2){let e=i.$implicit,o=c(2);w("seleccionado",o.diaSeleccionado===e.dia_semana),r(),k(" ",o.obtenerNombreDia(e.dia_semana)," ")}}function Z(t,i){if(t&1&&(n(0,"div",7)(1,"h6",4),l(2,"Eleg\xED un dia"),a(),n(3,"div",18),f(4,X,2,3,"button",19,B),a()()),t&2){let e=c();r(4),g(e.diasDisponibles)}}function ee(t,i){if(t&1){let e=S();n(0,"button",25),h("click",function(){let s=x(e).$implicit,d=c().$implicit,E=c(2);return b(E.seleccionarTurno(d.fecha,s))}),l(1),a()}if(t&2){let e=i.$implicit;r(),k(" ",e," ")}}function ie(t,i){if(t&1&&(n(0,"div",21)(1,"h4",22),l(2),V(3,"date"),a(),n(4,"div",23),f(5,ee,2,1,"button",24,L),a()()),t&2){let e=i.$implicit,o=c(2);r(2),D(" ",o.obtenerNombreDia(e.fecha.getDay()),": ",U(3,2,e.fecha,"dd/MM")," "),r(3),g(e.turnos)}}function te(t,i){if(t&1&&(n(0,"div",8)(1,"h3",4),l(2,"Turnos disponibles"),a(),f(3,ie,7,5,"div",21,G),a()),t&2){let e=c();r(3),g(e.turnosSemanas)}}var q=class t{constructor(i,e,o,s,d){this.u=i;this.sa=e;this.he=o;this.e=s;this.t=d}especialidades=[];especialidadSeleccionada=null;profesionales=[];profesionalSeleccionado=null;diaSeleccionado=null;turnosSemanas=[];pacientes=[];pacienteSeleccionado=null;ngOnInit(){return _(this,null,function*(){this.sa.showLoading(),this.especialidades=yield this.e.obtenerEspecialidades(),this.u.userData.perfil==="admin"&&(this.pacientes=yield this.u.obtenerUsuariosPacientes()),this.sa.closeLoading()})}seleccionarEspecialidad(i){return _(this,null,function*(){console.log(i.nombre),this.sa.showLoading(),this.especialidadSeleccionada=i,this.profesionalSeleccionado=null,this.pacienteSeleccionado=null,this.diaSeleccionado=null,this.profesionales=yield this.u.obtenerUsuariosEspecialistasPorEspecialidad(this.especialidadSeleccionada.id),this.sa.closeLoading()})}seleccionarProfesional(i){return _(this,null,function*(){console.log(i.nombre),this.sa.showLoading(),this.profesionalSeleccionado=i,this.sa.closeLoading()})}seleccionarPaciente(i){return _(this,null,function*(){console.log(i.nombre),this.pacienteSeleccionado=i,this.diaSeleccionado=null})}seleccionarDia(i){return _(this,null,function*(){if(this.u.userData.perfil==="admin"&&!this.pacienteSeleccionado){yield this.sa.showAlertError("Paciente","Primero selecciona un paciente");return}console.log("D\xEDa seleccionado:",i.dia_semana),this.sa.showLoading(),this.diaSeleccionado=i.dia_semana;let e=new Date,o=[];for(let p=1;p<=15;p++){let u=new Date;u.setDate(e.getDate()+p),u.getDay()===i.dia_semana&&o.push(u)}let s=(p,u)=>{let m=[];for(let y=p;y<u;y++)m.push(`${y}:00`),m.push(`${y}:30`);return m},d=yield this.t.obtenerTurnosProx15Dias(this.profesionalSeleccionado.id,"especialista"),E=this.u.userData.perfil==="admin"?yield this.t.obtenerTurnosProx15Dias(this.pacienteSeleccionado.id,"paciente"):[];this.turnosSemanas=o.slice(0,2).map(p=>({fecha:p,turnos:s(Number(i.hora_inicio),Number(i.hora_fin)).filter(u=>!d.some(m=>m.dia===p.toISOString().slice(0,10)&&m.hora===u+":00")&&!E.some(m=>m.dia===p.toISOString().slice(0,10)&&m.hora===u+":00"))})),console.log(this.turnosSemanas),this.sa.closeLoading()})}seleccionarTurno(i,e){return _(this,null,function*(){if(!(yield this.sa.confirmarAccion("\xBFConfirmar turno?",`\xBFQuer\xE9s reservar el turno del ${i.toLocaleDateString()} a las ${e}?`)))return;this.sa.showLoading();let s=this.u.userData.perfil==="admin"?this.pacienteSeleccionado.id:this.u.userId,d={dia:i,hora:e,id_paciente:s,id_especialista:this.profesionalSeleccionado.id,id_especialidad:this.especialidadSeleccionada.id,estado:"pendiente"},E=yield this.t.crearTurno(d);this.sa.closeLoading(),E?this.sa.showAlertSuccess("Turno reservado","Tu turno fue registrado correctamente."):this.sa.showAlertError("Error","No se pudo registrar el turno.")})}obtenerNombreDia(i){return["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"][i]??""}get diasDisponibles(){return this.profesionalSeleccionado?.horarios_especialista?.filter(i=>i.activo)||[]}static \u0275fac=function(e){return new(e||t)(v(H),v(z),v(A),v(j),v(Y))};static \u0275cmp=$({type:t,selectors:[["app-sacar-turno"]],decls:13,vars:4,consts:[[1,"card-container"],[1,"titulo"],[1,"profesionales"],[1,"especialidades"],[1,"sub-titulo"],[1,"especialidades-grid"],["type","button",1,"especialidad-card",3,"seleccionada"],[1,"turno-dias"],[1,"turnos-container"],[1,"profesionales-grid"],[1,"profesional-card",3,"seleccionada"],[1,"profesional-card",3,"click"],[1,"profesional-foto"],[3,"src","alt"],[1,"profesional-nombre"],["type","button",1,"especialidad-card",3,"click"],[1,"especialidad-icono-placeholder"],[1,"especialidad-nombre"],[1,"dias-grid"],["type","button",1,"dia-card",3,"seleccionado"],["type","button",1,"dia-card",3,"click"],[1,"turnos-semana"],[1,"turno-dia"],[1,"turnos-grid"],["type","button",1,"turno-buttons"],["type","button",1,"turno-buttons",3,"click"]],template:function(e,o){e&1&&(n(0,"main",0)(1,"h2",1),l(2,"Sacar Turno"),a(),C(3,Q,6,0,"div",2),n(4,"div",3)(5,"h6",4),l(6,"Eleg\xED una especialidad"),a(),n(7,"div",5),f(8,R,4,3,"button",6,F),a()(),C(10,W,6,0,"div",2),C(11,Z,6,0,"div",7),C(12,te,5,0,"div",8),a()),e&2&&(r(3),T(o.u.userData.perfil==="admin"?3:-1),r(5),g(o.especialidades),r(2),T(o.especialidadSeleccionada?10:-1),r(),T(o.profesionalSeleccionado?11:-1),r(),T(o.diaSeleccionado?12:-1))},dependencies:[N],styles:[".card-container[_ngcontent-%COMP%]{max-width:80%}.especialidades-grid[_ngcontent-%COMP%]{display:flex;gap:.3rem;justify-items:center;margin-bottom:.5rem;border-bottom:2px solid #51db84;padding-bottom:1.5rem;padding-top:.5rem;gap:1rem}.especialidad-card[_ngcontent-%COMP%]{max-width:40%;max-height:40%;border-radius:10px;border:2px solid var(--c-primary-dark);background:var(--c-primary);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease-in-out;padding:.3rem}.especialidad-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 3px 6px #00000026}.especialidad-card.seleccionada[_ngcontent-%COMP%]{border-color:var(--c-accent);background-color:var(--c-primary-dark)}.especialidad-icono-placeholder[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background-color:#d9d9d9}.especialidad-nombre[_ngcontent-%COMP%]{font-weight:600;color:var(--c-neutral);text-align:center;font-size:.9rem}.profesionales-grid[_ngcontent-%COMP%]{display:flex;gap:.3rem;align-items:center;justify-items:center;flex-direction:flex-start;margin-bottom:.5rem;border-bottom:2px solid #51db84;padding-bottom:1.5rem;padding-top:.5rem;gap:1rem}.profesional-card[_ngcontent-%COMP%]{max-width:100%;max-height:20%;border-radius:10px;border:2px solid var(--c-primary-dark);background:var(--c-primary);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease-in-out;padding:.3rem}.profesional-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 3px 6px #00000026}.profesional-card.seleccionada[_ngcontent-%COMP%]{border-color:var(--c-accent);background-color:var(--c-primary-dark)}.profesional-foto[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;background-color:#d9d9d9}.profesional-nombre[_ngcontent-%COMP%]{font-weight:600;color:var(--c-neutral);text-align:center;font-size:.9rem}.dias-grid[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:1rem}.dia-card[_ngcontent-%COMP%]{border:2px solid var(--c-primary-dark);border-radius:8px;background:var(--c-primary);color:var(--c-neutral);cursor:pointer;transition:all .2s ease-in-out;font-size:1rem}.dia-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.dia-card.seleccionado[_ngcontent-%COMP%]{border-color:var(--c-accent);background-color:var(--c-primary-dark)}.turnos-container[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1rem;border-top:2px solid var(--c-accent)}.turnos-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.3rem}.turnos-semana[_ngcontent-%COMP%]{margin-bottom:1.5rem}.turno-buttons[_ngcontent-%COMP%]{border:2px solid var(--c-primary-dark);border-radius:8px;background:var(--c-primary);color:var(--c-neutral);cursor:pointer;transition:all .2s ease-in-out;font-size:.7rem;font-weight:600}.turno-buttons[_ngcontent-%COMP%]:hover{transform:translateY(-2px);border-color:var(--c-accent)}.turno-dia[_ngcontent-%COMP%]{color:var(--c-primary-light);font-size:.9rem}"]})};export{q as SacarTurno};
